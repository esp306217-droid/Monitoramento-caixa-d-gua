
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reservatório PP7</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            color: #333;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #FFFFFF; /* Fundo branco */
        }
        .main-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 50px;
            width: 100%;
            padding: 20px;
        }
        .info-container {
            background-color: #ced4da; /* Cinza um pouco mais escuro */
            padding: 28px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid #adb5bd;
            width: 340px;
            z-index: 10;
        }
        h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.1rem;
            margin: 0 0 22px 0;
            color: #000;
            text-shadow: none;
        }
        .reservatorio-wrapper {
            width: 400px;
            height: 700px;
        }
        #reservatorio-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.2));
        }
        /* ESTRUTURA COM LINHAS PRETAS */
        #reservatorio-svg .estrutura-solida { fill: url(#gradiente-metal); stroke: #000; stroke-width: 2; }
        #reservatorio-svg .estrutura-vidro { fill: rgba(232, 232, 232, 0.35); stroke: #000; stroke-width: 2.5; }
        #reservatorio-svg .faixa-metalica { fill: none; stroke: #000; stroke-width: 2; }
        #reservatorio-svg .guarda-corpo { fill: none; stroke: #000; stroke-width: 3; }
        #reservatorio-svg .base-concreto { fill: #C0C0C0; stroke: #000; stroke-width: 2; }
        #reservatorio-svg .suportes-base { fill: #A9A9A9; stroke: #000; stroke-width: 1.5; }

        /* Estilos da ÁGUA com ONDA */
        #agua-rect {
            transition: y 0.9s cubic-bezier(0.4, 0, 0.2, 1), fill 0.5s;
        }
        #agua-rect::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 20px;
            background: rgba(255,255,255,0.4);
            top: -10px;
            left: -50%;
            border-radius: 50%;
            animation: onda 2s infinite linear;
            z-index: 1; /* Para garantir que a onda esteja acima da água */
            pointer-events: none; /* Não interfere com cliques */
        }
        @keyframes onda {
            0% {transform:translateX(0);}
            100% {transform:translateX(50px);}
        }

        #percentual-texto {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 55px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: middle;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.6s;
        }
        #percentual-texto.visible { opacity: 1; }
        .info { margin-top: 25px; font-size: 1.3rem; font-weight: bold; color: #333; }
        .leds { margin-top: 30px; display: flex; justify-content: center; gap: 28px; }
        .led {
            width: 45px; height: 45px;
            border-radius: 50%;
            background: #e0e0e0;
            box-shadow: inset 0 0 12px rgba(0,0,0,0.3);
            transition: all 0.4s ease-in-out;
            border: 2px solid #bbb;
            opacity: 0.5;
        }
        .led.acesso {
            opacity: 1;
            box-shadow: 0 0 18px currentColor, 0 0 35px currentColor, inset 0 0 12px rgba(255,255,255,0.6);
            animation: blink 1s infinite;
        }
        @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0.2; } }
        .logo { position: fixed; bottom: 20px; right: 20px; width: 130px; opacity: 0.8; transition: opacity 0.3s ease; }
        .logo:hover { opacity: 1; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="reservatorio-wrapper">
            <svg id="reservatorio-svg" viewBox="0 0 400 950" preserveAspectRatio="xMidYMin meet">
                <defs>
                    <linearGradient id="grad-agua-azul" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#00ffcc;"/><stop offset="100%" style="stop-color:#1e90ff;"/></linearGradient>
                    <linearGradient id="grad-agua-amarela" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#ffff66;"/><stop offset="100%" style="stop-color:#ffcc00;"/></linearGradient>
                    <linearGradient id="grad-agua-vermelha" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#ff3333;"/><stop offset="100%" style="stop-color:#990000;"/></linearGradient>
                    <linearGradient id="gradiente-metal" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#DADADA"/><stop offset="50%" stop-color="#FAFAFA"/><stop offset="100%" stop-color="#CFCFCF"/></linearGradient>
                    <clipPath id="mascara-agua"><path d="M 105 220 L 295 220 L 295 440 L 265 500 L 135 500 L 105 440 Z"/></clipPath>
                </defs>

                <g clip-path="url(#mascara-agua)">
                    <rect id="agua-rect" x="100" y="500" width="200" height="280" fill="url(#grad-agua-vermelha)"/>
                    <rect id="onda-rect" x="100" y="500" width="200" height="20" fill="rgba(255,255,255,0.4)" style="transform-origin: 50% 50%; border-radius: 50%; animation: onda 2s infinite linear;"/>
                </g>

                <g id="estrutura-reservatorio">
                    <g id="base">
                        <path class="base-concreto" d="M 80 950 L 320 950 L 310 930 L 90 930 Z"/>
                        <path class="suportes-base" d="M 130 930 L 120 940 L 140 940 Z M 170 930 L 160 940 L 180 940 Z M 210 930 L 200 940 L 220 940 Z M 250 930 L 240 940 L 260 940 Z M 290 930 L 280 940 L 300 940 Z"/>
                    </g>
                    <g id="coluna">
                        <path class="estrutura-solida" d="M 135 930 L 135 500 L 265 500 L 265 930 Z"/>
                        <path class="faixa-metalica" d="M 135 620 L 265 620 M 135 770 L 265 770"/>
                    </g>
                    <g id="taca-transparente">
                        <path class="estrutura-vidro" d="M 100 440 L 100 220 L 300 220 L 300 440 L 265 500 L 135 500 Z"/>
                        <path class="faixa-metalica" d="M 100 290 L 300 290 M 100 360 L 300 360"/>
                        <path class="guarda-corpo" d="M 100 220 A 100 25 0 0 1 300 220 M 105 210 A 90 20 0 0 1 295 210 M 110 200 A 80 15 0 0 1 290 200"/>
                    </g>
                </g>
                
                <text id="percentual-texto" x="200" y="360">0%</text>
            </svg>
        </div>

        <div class="info-container">
            <h2>NÍVEL DO RESERVATÓRIO</h2>
            <div class="info">Altura: <span id="altura">0</span> cm</div>
            <div class="info">Nível: <span id="nivel">0</span>%</div>
            <div class="leds">
                <div class="led" id="ledVerde" style="background-color: #28a745;"></div>
                <div class="led" id="ledAmarelo" style="background-color: #ffc107;"></div>
                <div class="led" id="ledVermelho" style="background-color: #dc3545;"></div>
            </div>
        </div>
    </div>

    <img src="https://viacristais.tribox.info/wp-content/uploads/2025/01/ViaCristais_compact_RGB-800x600.jpg" alt="Logo ViaCristais" class="logo">

    <script>
        const ALTURA_AGUA_SVG = 280;
        const POS_Y_TOPO_AGUA = 220;

        async function atualizar() {
            try {
                let j;
                // Para testes locais, descomente a linha abaixo
                // j = { nivel_pct: Math.floor(Math.random() * 101), altura_cm: (Math.random() * 820).toFixed(1) };
                
                if (window.location.hostname.includes("192.168.") || window.location.hostname.includes("10.")) {
                    const r = await fetch('/data');
                    j = await r.json();
                } else {
                    const r = await fetch('https://monitoramento-caixa-d-agua-default-rtdb.firebaseio.com/PP7.json');
                    j = await r.json();
                }

                const nivel = j.nivel_pct || j.nivel || 0;
                const altura = j.altura_cm || 0;

                document.getElementById('nivel').innerText = nivel;
                document.getElementById('altura').innerText = altura.toFixed(1);

                const aguaRect = document.getElementById('agua-rect');
                const ondaRect = document.getElementById('onda-rect'); // Pega o elemento da onda
                const textoPct = document.getElementById('percentual-texto');
                const posY = POS_Y_TOPO_AGUA + ALTURA_AGUA_SVG * (1 - nivel / 100);

                aguaRect.setAttribute('y', posY);
                ondaRect.setAttribute('y', posY - 10); // Onda 10px acima da água

                textoPct.textContent = nivel + '%';
                textoPct.classList.toggle('visible', nivel > 5);

                const verde = document.getElementById('ledVerde');
                const amarelo = document.getElementById('ledAmarelo');
                const vermelho = document.getElementById('ledVermelho');
                
                verde.classList.remove('acesso');
                amarelo.classList.remove('acesso');
                vermelho.classList.remove('acesso');

                // Lógica de cor da água e LEDs
                if (nivel >= 60) {
                    aguaRect.setAttribute('fill', 'url(#grad-agua-azul)');
                    verde.classList.add('acesso');
                } else if (nivel >= 31) { // Mudei para 31, seu código de referência usava 20. Ajuste conforme preferir.
                    aguaRect.setAttribute('fill', 'url(#grad-agua-amarela)');
                    amarelo.classList.add('acesso');
                } else {
                    aguaRect.setAttribute('fill', 'url(#grad-agua-vermelha)');
                    vermelho.classList.add('acesso');
                }
            } catch (e) {
                console.error("Erro ao atualizar dados:", e);
            }
        }
        window.onload = function() {
            atualizar();
            setInterval(atualizar, 3000);
        }
    </script>
</body>
</html>

}
