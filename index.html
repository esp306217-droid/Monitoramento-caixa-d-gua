<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monitoramento Caixa D’Água PP7</title>

<!-- Fonte -->
<link href="https://fonts.googleapis.com/css2?family=ADLaM+Display&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'ADLaM Display', cursive;
  text-align: center;
  background: #fff;
  margin: 0;
  color: #000;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h2 {
  font-size: 2.4rem;
  margin: 20px 0 5px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.25);
}

.container {
  display: flex;
  align-items: flex-start;
  justify-content: center;
  gap: 10px;
  margin-top: -25px;
  flex-wrap: wrap;
}

.reservatorio-wrapper {
  width: 460px;
  height: 780px;
  position: relative;
  transform: scale(1.08);
  margin-top: -20px;
}

#reservatorio-svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(4px 4px 10px rgba(0,0,0,0.3));
}

#reservatorio-svg .estrutura-solida { fill: url(#grad-metal); stroke: #000; stroke-width: 2; opacity: 0.7; }
#reservatorio-svg .taca-solida { fill: url(#grad-metal); stroke: #000; stroke-width: 2; opacity: 0.3; }
#reservatorio-svg .faixa-metalica { fill: none; stroke: #000; stroke-width: 2; opacity: 0.3; }
#reservatorio-svg .guarda-corpo { fill: none; stroke: #000; stroke-width: 2; opacity: 0.4; }
#reservatorio-svg .base-concreto { fill: #C0C0C0; stroke: #000; stroke-width: 2; opacity: 0.8; }
#reservatorio-svg .suportes-base { fill: #A9A9A9; stroke: #000; stroke-width: 1.5; opacity: 0.8; }

.agua-wrapper {
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

.agua {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(to top, #00ffcc, #1e90ff);
  transition: height 0.6s ease;
  overflow: hidden;
  color: white;
  font-weight: bold;
  text-align: center;
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  justify-content: center;
}
.agua::before, .agua::after {
  content: "";
  position: absolute;
  width: 200%;
  height: 20px;
  top: -10px;
  left: -50%;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
}
.agua::before { animation: onda1 3s infinite linear; }
.agua::after { background: rgba(255,255,255,0.2); top: -8px; animation: onda2 5s infinite linear; }

@keyframes onda1 { 0% { transform: translateX(0); } 100% { transform: translateX(50px); } }
@keyframes onda2 { 0% { transform: translateX(0); } 100% { transform: translateX(-50px); } }

/* Painel lateral */
.painel {
  background: linear-gradient(180deg, #e0e0e0, #bdbdbd);
  padding: 15px 18px;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 15px;
  width: 240px;
  height: 150px;
  justify-content: center;
  margin-top: 130px;
}

.leds {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.led {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #999;
  box-shadow: inset 0 0 8px rgba(0,0,0,0.4);
  transition: all 0.4s ease;
}
.led.acesso {
  box-shadow: 0 0 15px currentColor, 0 0 30px currentColor, inset 0 0 8px rgba(255,255,255,0.6);
  animation: pisca 1.2s infinite;
}
@keyframes pisca { 0%,49%{opacity:1;}50%,100%{opacity:0.3;} }

.info {
  font-size: 1.1rem;
  color: #000;
  text-align: left;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.logo {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 120px;
  opacity: 0.9;
}

@media (max-width: 900px) {
  .container {
    flex-direction: column;
    align-items: center;
  }
  .painel {
    flex-direction: row;
    width: 80%;
    margin-top: 10px;
  }
}
</style>
</head>
<body>

<img class="logo" src="https://viacristais.tribox.info/wp-content/uploads/2025/01/ViaCristais_compact_RGB-800x600.jpg" alt="Logo ViaCristais">
<h2>Monitoramento Caixa D’Água PP7</h2>

<div class="container">
  <!-- Caixa -->
  <div class="reservatorio-wrapper">
    <svg id="reservatorio-svg" viewBox="0 0 400 950" preserveAspectRatio="xMidYMin meet">
      <defs>
        <linearGradient id="grad-metal" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#DADADA"/>
          <stop offset="50%" stop-color="#FAFAFA"/>
          <stop offset="100%" stop-color="#CFCFCF"/>
        </linearGradient>
        <clipPath id="mascara-agua">
          <path d="M 105 220 L 295 220 L 295 440 L 265 500 L 135 500 L 105 440 Z"/>
        </clipPath>
      </defs>

      <foreignObject x="105" y="220" width="190" height="280" clip-path="url(#mascara-agua)">
        <div xmlns="http://www.w3.org/1999/xhtml" class="agua-wrapper">
          <div class="agua" id="agua">0%</div>
        </div>
      </foreignObject>

      <g id="estrutura-reservatorio">
        <g id="base">
          <path class="base-concreto" d="M 80 950 L 320 950 L 310 930 L 90 930 Z"/>
          <path class="suportes-base" d="M 130 930 L 120 940 L 140 940 Z M 170 930 L 160 940 L 180 940 Z M 210 930 L 200 940 L 220 940 Z M 250 930 L 240 940 L 260 940 Z M 290 930 L 280 940 L 300 940 Z"/>
        </g>

        <g id="coluna">
          <path class="estrutura-solida" d="M 135 930 L 135 500 L 265 500 L 265 930 Z"/>
          <path class="faixa-metalica" d="M 135 620 L 265 620 M 135 770 L 265 770"/>
        </g>

        <g id="taca-solida">
          <path class="taca-solida" d="M 100 440 L 100 220 L 300 220 L 300 440 L 265 500 L 135 500 Z"/>
          <path class="guarda-corpo" d="M 100 220 A 100 25 0 0 1 300 220"/>
        </g>
      </g>
    </svg>
  </div>

  <!-- Painel lateral -->
  <div class="painel">
    <div class="leds">
      <div class="led" id="ledVerde" style="background-color:#28a745;"></div>
      <div class="led" id="ledAmarelo" style="background-color:#ffc107;"></div>
      <div class="led" id="ledVermelho" style="background-color:#dc3545;"></div>
    </div>
    <div class="info">
      <div>Nível: <span id="nivel">0</span>%</div>
      <div>Altura: <span id="altura">0</span> cm</div>
    </div>
  </div>
</div>

<script>
async function atualizar() {
  try {
    let j;
    if (window.location.hostname.includes("192.168.") || window.location.hostname.includes("10.")) {
      const r = await fetch('/data');
      j = await r.json();
    } else {
      const r = await fetch('https://monitoramento-caixa-d-agua-default-rtdb.firebaseio.com/PP7.json');
      j = await r.json();
    }

    const nivel = j.nivel_pct || j.nivel || 0;
    const altura = j.altura_cm || 0;

    document.getElementById('nivel').innerText = nivel;
    document.getElementById('altura').innerText = altura.toFixed(1);

    const aguaDiv = document.getElementById('agua');
    aguaDiv.style.height = nivel + '%';
    aguaDiv.innerText = nivel + '%';

    if (nivel > 60) aguaDiv.style.background = 'linear-gradient(to top, #00ffcc, #1e90ff)';
    else if (nivel > 20) aguaDiv.style.background = 'linear-gradient(to top, #ffff66, #ffcc00)';
    else aguaDiv.style.background = 'linear-gradient(to top, #ff3333, #990000)';

    const verde = document.getElementById('ledVerde');
    const amarelo = document.getElementById('ledAmarelo');
    const vermelho = document.getElementById('ledVermelho');
    verde.classList.remove('acesso');
    amarelo.classList.remove('acesso');
    vermelho.classList.remove('acesso');

    if (nivel > 60) verde.classList.add('acesso');
    else if (nivel > 20) amarelo.classList.add('acesso');
    else vermelho.classList.add('acesso');

  } catch (e) { console.error("Erro ao atualizar dados:", e); }
}

window.onload = function() {
  atualizar();
  setInterval(atualizar, 2000);
}
</script>
</body>
</html>
